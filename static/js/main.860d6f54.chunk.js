(this.webpackJsonpbracsa=this.webpackJsonpbracsa||[]).push([[0],[,,function(e,t,n){e.exports={chordbuttons:"ChordButtons_chordbuttons__1fCK-",pending:"ChordButtons_pending__2QeOF",active:"ChordButtons_active__1aWxQ",stop:"ChordButtons_stop__3dkpU"}},function(e,t,n){e.exports={sustain:"Sustain_sustain__yapZz",left:"Sustain_left__F1938",right:"Sustain_right__3zI1A",tuner:"Sustain_tuner__3wHn5"}},function(e,t,n){e.exports={chordview:"ChordView_chordview__1UQS7"}},function(e,t,n){e.exports={sliders:"Sliders_sliders__lzxZi",tuner:"Sliders_tuner__vf4HX"}},,function(e,t,n){e.exports={app:"App_app__2ziFi",chords:"App_chords__7aOCV"}},,,,function(e,t,n){e.exports={tuning:"Tuning_tuning__36ecz"}},,,,,function(e,t,n){},,,,,,,function(e,t,n){"use strict";n.r(t);var s=n(1),a=n.n(s),c=n(8),i=n.n(c),o=(n(16),n(7)),l=n.n(o),r=n(9),u=n.n(r);const d=window._tone_0411_FluidR3_GM_sf2_file;class j{constructor(){this.player=void 0,this.audioContext=void 0,this.envelopes=[],this.volume=.5,this.playbackRate=1,this.duration=.3;const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e,this.player=new u.a,this.player.loader.decodeAfterLoading(this.audioContext,"_tone_0411_FluidR3_GM_sf2_file")}queueNote(e,t){const n=this.player.findZone(this.audioContext,d,e),s=n.originalPitch-100*n.coarseTune-n.fineTune,a=this.playbackRate*Math.pow(2,(100*e-s)/1200),c=this.player.queueWaveTable(this.audioContext,this.audioContext.destination,d,0,e,t,this.volume);c.audioBufferSourceNode.playbackRate.cancelScheduledValues(0),c.audioBufferSourceNode.playbackRate.setValueAtTime(a,0),this.envelopes.push(c)}playChord(e){this.stop(),null===e||void 0===e||e.forEach((e=>this.queueNote(e,this.duration)))}stop(){for(;;){const e=this.envelopes.pop();if(!e)break;e.cancel()}}get playing(){return this.envelopes.length>0}setFreq(e){this.playbackRate=e/440;const t=this.envelopes.map((e=>e.pitch));this.playChord(t)}setVolume(e){this.volume=e,0===this.volume&&(this.volume=1e-4);const t=this.envelopes.map((e=>e.pitch));this.playChord(t)}setDuration(e){this.duration=e}}var b=n(10);const h=["C","C\u266f","D","E\u266d","E","F","F\u266f","G","A\u266d","A","B","H"],p=[0,1,2,3,4,5,6,7,8,9,10,11],O=[6,1,8,3,10,5,0,7,2,9,4,11],m=["","m","7","dim","dim7","5","6","m7","maj7","sus2","sus4","m6","aug"];function v({TUNING:e,MAX_POS:t}){const n=[],s=e=>{const t=e.map((e=>e%12));return t.sort(((e,t)=>e-t)),t},a=(e,t,n)=>({base:e,type:t,notes:s(n)}),c=(e,t,n,s)=>[a(e,t,[n[0],n[1],s]),a(e,t,[n[0],s,n[2]]),a(e,t,[s,n[1],n[2]])];(()=>{for(let e=0;e<12;e++)n.push(a(e,0,[e,e+4,e+4+3]),a(e,1,[e,e+3,e+3+4]),...c(e,2,[e,e+4,e+4+3],e+4+3+3),a(e,3,[e,e+3,e+6]),...c(e,4,[e,e+3,e+6],e+3+3+3),a(e,5,[e,e,e+3+4]),a(e,5,[e,e+3+4,e+3+4]),...c(e,6,[e,e+4,e+4+3],e+4+3+2),...c(e,7,[e,e+3,e+3+4],e+4+3+3),...c(e,8,[e,e+4,e+4+3],e+4+3+4),a(e,9,[e,e+2,e+4+3]),a(e,10,[e,e+5,e+4+3]),...c(e,11,[e,e+3,e+3+4],e+4+3+2),a(e,12,[e,e+4,e+4+4]))})();const i=e=>{const t=e.map((e=>e%12)).sort(((e,t)=>e-t));return n.filter((e=>Object(b.isEqual)(e.notes,t))).map((e=>({base:e.base,type:e.type})))},o=t=>t.map(((t,n)=>t-e[n])).reduce(((e,t)=>0===t?e+2:e+t),0),l=[];return function(){for(let s=0;s<t;s++)for(let n=0;n<t;n++)for(let a=0;a<t;a++){const t=[e[0]+s,e[1]+n,e[2]+a];i(t).forEach((e=>{Array.isArray(l[e.base])||(l[e.base]=[]),Array.isArray(l[e.base][e.type])||(l[e.base][e.type]=[]),l[e.base][e.type].push(t)}))}for(let e=0;e<l.length;e++)if(l[e])for(let t=0;t<l[e].length;t++){var n;(null!==(n=l[e][t])&&void 0!==n?n:[]).sort(((e,t)=>o(e)-o(t)))}}(),{getChordPitches(e,t){var n;return null===(n=l[e])||void 0===n?void 0:n[t]},getChordPositions(t,n){var s,a;return null===(s=l[t])||void 0===s||null===(a=s[n])||void 0===a?void 0:a.map((t=>t.map(((t,n)=>t-e[n]))))},positionsToPitches:t=>e.map(((e,n)=>t[n]+e)),getAlternativeNames(t){const n=t.map(((t,n)=>e[n]+t));return i(n).sort(((e,t)=>e.type-t.type)).map((e=>`${h[e.base]}${m[e.type]}`))},TUNING:e,MAX_POS:t}}var x=n(2),y=n.n(x),g=n(0);const f=a.a.memo((e=>{const{activeButton:t,pendingType:n,layout:s,typeIndex:a,onClick:c}=e,i="chromatic"===s?p:O,o=e=>t===e;return Object(g.jsxs)("tr",{className:n===a?y.a.pending:"",children:[Object(g.jsx)("td",{children:a<9&&"chromatic"===s?a+1:""}),i.map((e=>{return Object(g.jsx)("td",{children:Object(g.jsxs)("button",{style:{..."chromatic"!==s||o(e)?{}:{background:(t=e,1===N[t]?"#eee":"#bbb")}},className:o(e)?y.a.active:"",onClick:()=>c(e,a),children:[h[e],m[a]]})},e+a);var t}))]},a)})),S=["z","s","x","d","c","v","g","b","h","n","j","m"],C=["KeyZ","KeyS","KeyX","KeyD","KeyC","KeyV","KeyG","KeyB","KeyH","KeyN","KeyJ","KeyM"],N=[1,0,1,0,1,1,0,1,0,1,0,1],_=["1","2","3","4","5","6","7","8","9","0","-","="],k=["Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal"],K=["KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight"],T=["KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Backslash"],A=e=>{const{activeNote:t,activeType:n,pendingType:s,layout:a,setLayout:c,onClick:i,onStop:o}=e,l="chromatic"===a?S:_;return Object(g.jsxs)("div",{className:y.a.chordbuttons,children:[Object(g.jsxs)("table",{children:[Object(g.jsx)("thead",{children:Object(g.jsxs)("tr",{children:[Object(g.jsx)("td",{children:Object(g.jsx)("strong",{children:"Key"})}),l.map((e=>Object(g.jsx)("td",{children:e},e)))]})}),Object(g.jsxs)("tbody",{children:[m.map(((e,c)=>Object(g.jsx)(f,{layout:a,typeIndex:c,activeButton:n!==c?null:t,pendingType:s,onClick:i},e))),Object(g.jsxs)("tr",{children:[Object(g.jsx)("td",{children:"Space"}),Object(g.jsx)("td",{colSpan:12,children:Object(g.jsx)("button",{className:y.a.stop,onClick:o,children:"Stop"})})]})]})]}),Object(g.jsxs)("label",{children:[Object(g.jsx)("input",{type:"radio",name:"layout",value:"chromatic",checked:"chromatic"===a,onChange:e=>c(e.target.value)}),"Chromatic"]}),"\xa0\xa0\xa0\xa0",Object(g.jsxs)("label",{children:[Object(g.jsx)("input",{type:"radio",name:"layout",value:"fifths",checked:"fifths"===a,onChange:e=>c(e.target.value)}),"Circle of fifths"]})]})};var I=n(4),P=n.n(I);const w=e=>{const{tuning:t,maxPos:n,isChecked:s,positions:c,onClick:i,getAlternativeNames:o}=e,l=(e,t)=>h[(e+t)%12];return Object(g.jsxs)("div",{className:P.a.wrapper,onClick:()=>i(c),children:[Object(g.jsxs)("table",{className:P.a.chordview,children:[Object(g.jsxs)("thead",{children:[Object(g.jsx)("tr",{children:Object(g.jsx)("th",{colSpan:3,children:Object(g.jsx)("input",{type:"checkbox",checked:s,readOnly:!0})})}),Object(g.jsxs)("tr",{children:[Object(g.jsx)("th",{children:l(t[0],c[0])}),Object(g.jsx)("th",{children:l(t[1],c[1])}),Object(g.jsx)("th",{children:l(t[2],c[2])})]})]}),Object(g.jsx)("tbody",{children:new Array(n-1).fill(0).map(((e,t)=>Object(g.jsxs)("tr",{children:[Object(g.jsx)("td",{children:c[0]===t+1?"\u25cf":""}),Object(g.jsx)("td",{children:c[1]===t+1?"\u25cf":""}),Object(g.jsx)("td",{children:c[2]===t+1?"\u25cf":""})]},t)))})]}),Object(g.jsx)("div",{className:P.a.names,children:o(c).map((e=>Object(g.jsxs)(a.a.Fragment,{children:[e,Object(g.jsx)("br",{})]},e)))})]})};var D=n(5),E=n.n(D);function M(e,t){const[n,a]=Object(s.useState)(e);return Object(s.useEffect)((()=>{const n=setTimeout((()=>{a(e)}),t);return()=>{clearTimeout(n)}}),[e,t]),n}const F=a.a.memo((e=>{const{onSetVolume:t,onSetTuning:n}=e,[a,c]=Object(s.useState)(.5),i=M(a,50),[o,l]=Object(s.useState)(440),r=M(o,25);return Object(s.useEffect)((()=>{t(i)}),[t,i]),Object(s.useEffect)((()=>{n(r)}),[n,r]),Object(g.jsxs)("div",{className:E.a.sliders,children:[Object(g.jsxs)("label",{children:["Fine tuning",Object(g.jsx)("br",{}),Object(g.jsx)("input",{className:E.a.tuner,type:"range",step:"0.1",min:"400",max:"500",value:o,onChange:e=>l(Number(e.target.value))})]}),Object(g.jsxs)("label",{children:["Volume",Object(g.jsx)("br",{}),Object(g.jsx)("input",{className:E.a.tuner,type:"range",step:"0.02",min:"0",max:"1",value:a,onChange:e=>c(Number(e.target.value))})]})]})}));var B=n(3),G=n.n(B);const U=a.a.memo((e=>{const{onSetSustain:t}=e,[n,a]=Object(s.useState)(.3),c=M(n,25);return Object(s.useEffect)((()=>{t(c)}),[t,c]),Object(g.jsxs)("div",{className:G.a.sustain,children:[Object(g.jsxs)("div",{className:G.a.left,children:[Object(g.jsxs)("label",{children:[Object(g.jsx)("input",{type:"radio",name:"sustain",value:"sustain",checked:null===n,onChange:e=>a(null)}),"Sustain"]}),"\xa0\xa0\xa0\xa0",Object(g.jsxs)("label",{children:[Object(g.jsx)("input",{type:"radio",name:"sustain",value:"release",checked:null!==n,onChange:e=>a(.3)}),"Auto release"]})]}),Object(g.jsx)("div",{className:G.a.right,children:Object(g.jsxs)("label",{children:["Auto release timing",Object(g.jsx)("br",{}),Object(g.jsx)("input",{className:G.a.tuner,type:"range",step:"0.02",min:"0",max:"1",disabled:null===n,value:n,onChange:e=>a(Number(e.target.value))})]})})]})}));var L=n(11),R=n.n(L);const X=a.a.memo((e=>{const{tuning:t,maxPos:n,onSetTuning:s,onSetMaxNote:a}=e,c=[...h.map(((e,t)=>({label:e,value:48+t}))),...h.map(((e,t)=>({label:`${e}'`,value:60+t})))],i=[...Array(10).fill(0).map(((e,t)=>({label:7+t,value:7+t})))],o=e=>Object(g.jsx)("select",{value:t[e],onChange:n=>s(((e,n)=>{const s=[...t];return s[e]=n,s})(e,Number(n.currentTarget.value))),children:c.map((e=>Object(g.jsx)("option",{value:e.value,children:e.label},e.value)))});return Object(g.jsxs)("div",{className:R.a.tuning,children:[Object(g.jsxs)("div",{children:[Object(g.jsx)("label",{children:"Tuning:"}),Object(g.jsxs)("span",{children:[o(0),o(1),o(2),Object(g.jsx)("button",{onClick:()=>s([55,62,57]),children:"Reset"})]})]}),Object(g.jsxs)("div",{children:[Object(g.jsx)("label",{children:"Max position:"}),Object(g.jsx)("select",{value:n,onChange:e=>a(Number(e.currentTarget.value)),children:i.map((e=>Object(g.jsx)("option",{value:e.value,children:e.label},e.value)))})]})]})}));var V,q,J,$;const z=[Number(null!==(V=localStorage.getItem("viola-tuning-1"))&&void 0!==V?V:"55"),Number(null!==(q=localStorage.getItem("viola-tuning-2"))&&void 0!==q?q:"62"),Number(null!==(J=localStorage.getItem("viola-tuning-3"))&&void 0!==J?J:"57")],H=Number(null!==($=localStorage.getItem("viola-max-pos"))&&void 0!==$?$:"8");var Q=()=>{var e;const t=Object(s.useRef)(null),[n,a]=Object(s.useState)(!1);Object(s.useEffect)((()=>{t.current=new j,a(!0)}),[]);const[c,i]=Object(s.useState)(v({TUNING:z,MAX_POS:H})),[o,r]=Object(s.useState)(0),[u,d]=Object(s.useState)(0),[b,p]=Object(s.useState)(!0),[x,y]=Object(s.useState)(null),[f,S]=Object(s.useState)("chromatic"),[,N]=Object(s.useState)(0),_=Object(s.useCallback)(((e,t)=>`viola-${c.TUNING.join("-")}-${e}${t}`),[c]),I=_(h[o],m[u]),P=Object(s.useCallback)(((e,t)=>{const n=_(e,t),s=localStorage.getItem(n);if(s)try{const e=JSON.parse(s);if(Array.isArray(e)&&3===e.length&&e.every((e=>Number.isInteger(e))))return c.positionsToPitches(e)}catch(i){}const a=c.getChordPitches(h.indexOf(e),m.indexOf(t));return null===a||void 0===a?void 0:a[0]}),[_,c]),D=Object(s.useCallback)(((e,n)=>{const s=P(h[e],m[n]);s&&t.current.playChord(s),r(e),d(n),y(null)}),[P]),E=null!==(e=c.getChordPositions(o,u))&&void 0!==e?e:[],M=e=>{const n=c.positionsToPitches(e);n&&(t.current.playChord(n),localStorage.setItem(I,JSON.stringify(e))),N(Date.now())},B=Object(s.useCallback)((()=>{t.current.stop()}),[]),G=Object(s.useCallback)(((e,t)=>{if(C.includes(t))return D(C.indexOf(t)%12,null!==x&&void 0!==x?x:u),y(null),!0;const n=["1","2","3","4","5","6","7","8","9"];return n.includes(e)?(y(n.indexOf(e)),!0):" "===e&&(B(),!0)}),[B,x,u,D]),L=Object(s.useCallback)(((e,t)=>k.includes(t)?(D(O[k.indexOf(t)%12],0),y(null),!0):K.includes(t)?(D(O[K.indexOf(t)%12],1),y(null),!0):T.includes(t)?(D(O[T.indexOf(t)%12],2),y(null),!0):" "===e&&(B(),!0)),[B,D]);Object(s.useEffect)((()=>{const e=e=>{if(e.ctrlKey||e.shiftKey||e.altKey)return;if(e.repeat)return;("chromatic"===f?G(e.key,e.code):L(e.key,e.code))&&(e.preventDefault(),e.stopPropagation())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[f,G,L]),Object(s.useEffect)((()=>{if(!b)return;const e=e=>{if(!(e.ctrlKey||e.shiftKey||e.altKey))return C.includes(e.code)||k.includes(e.code)||K.includes(e.code)||T.includes(e.code)?(B(),e.preventDefault(),e.stopPropagation(),!0):void 0};return document.addEventListener("keyup",e),()=>document.removeEventListener("keyup",e)}),[B,b]);const R=Object(s.useCallback)((e=>{t.current.setFreq(e)}),[]),V=Object(s.useCallback)((e=>{null===e?(t.current.setDuration(999),p(!0)):(t.current.setDuration(e),p(!1))}),[]),q=Object(s.useCallback)((e=>{t.current.setVolume(e)}),[]),J=Object(s.useCallback)((e=>{e.forEach(((e,t)=>{localStorage.setItem(`viola-tuning-${t+1}`,e.toString())})),i(v({TUNING:e,MAX_POS:c.MAX_POS}))}),[c.MAX_POS]),$=Object(s.useCallback)((e=>{localStorage.setItem("viola-max-pos",e.toString()),i(v({TUNING:c.TUNING,MAX_POS:e}))}),[c.TUNING]);if(!n)return null;return Object(g.jsxs)("div",{className:l.a.app,children:[Object(g.jsx)(A,{activeNote:o,activeType:u,pendingType:x,onClick:D,onStop:B,layout:f,setLayout:S}),Object(g.jsx)(U,{onSetSustain:V}),Object(g.jsx)(F,{onSetTuning:R,onSetVolume:q}),Object(g.jsx)(X,{tuning:c.TUNING,maxPos:c.MAX_POS,onSetTuning:J,onSetMaxNote:$}),Object(g.jsx)("div",{className:l.a.chords,children:E.map((e=>(e=>{const t=JSON.stringify(e),n=t===localStorage.getItem(I);return Object(g.jsx)(w,{positions:e,tuning:c.TUNING,maxPos:c.MAX_POS,onClick:M,isChecked:n,getAlternativeNames:c.getAlternativeNames},t)})(e)))})]})};var Z=e=>{e&&e instanceof Function&&n.e(3).then(n.bind(null,24)).then((({getCLS:t,getFID:n,getFCP:s,getLCP:a,getTTFB:c})=>{t(e),n(e),s(e),a(e),c(e)}))};i.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(Q,{})}),document.getElementById("root")),Z()}],[[23,1,2]]]);
//# sourceMappingURL=main.860d6f54.chunk.js.map