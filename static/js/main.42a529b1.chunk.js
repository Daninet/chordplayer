(this.webpackJsonpbracsa=this.webpackJsonpbracsa||[]).push([[0],{12:function(e,t,s){},19:function(e,t,s){"use strict";s.r(t);var n=s(1),c=s.n(n),o=s(5),r=s.n(o),a=(s(12),s(2)),i=s.n(a),l=s(6),d=s.n(l);const u=window._tone_0411_FluidR3_GM_sf2_file;class h{constructor(){this.player=void 0,this.audioContext=void 0,this.envelopes=[],this.volume=1,this.playbackRate=1;const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e,this.player=new d.a,this.player.loader.decodeAfterLoading(this.audioContext,"_tone_0411_FluidR3_GM_sf2_file"),console.log(this.player,u)}queueNote(e,t){const s=this.player.findZone(this.audioContext,u,e),n=s.originalPitch-100*s.coarseTune-s.fineTune,c=this.playbackRate*Math.pow(2,(100*e-n)/1200),o=this.player.queueWaveTable(this.audioContext,this.audioContext.destination,u,0,e,t,this.volume);console.log("i",e,c),o.audioBufferSourceNode.playbackRate.cancelScheduledValues(0),o.audioBufferSourceNode.playbackRate.setValueAtTime(c,0),this.envelopes.push(o)}playChord(e){this.stop(),e.forEach((e=>this.queueNote(e,999)))}stop(){for(;;){const e=this.envelopes.pop();if(!e)break;e.cancel()}}setFreq(e){this.playbackRate=e/440;const t=this.envelopes.map((e=>e.pitch));this.playChord(t)}}var p=s(7);const b=["C","C\u266f","D","E\u266d","E","F","F\u266f","G","A\u266d","A","B","H"],j=["","m","7","dim","5","6","m7","maj7","sus2","sus4","m6","aug"],x=[55,62,57],O=[],f=e=>{const t=e.map((e=>e%12));return t.sort(((e,t)=>e-t)),t},y=(e,t,s)=>({base:e,type:t,notes:f(s)}),m=(e,t,s,n)=>[y(e,t,[s[0],s[1],n]),y(e,t,[s[0],n,s[2]]),y(e,t,[n,s[1],s[2]])];(()=>{for(let e=0;e<12;e++)O.push(y(e,0,[e,e+4,e+4+3]),y(e,1,[e,e+3,e+3+4]),...m(e,2,[e,e+4,e+4+3],e+4+3+3),y(e,3,[e,e+3,e+6]),y(e,4,[e,e,e+3+4]),y(e,4,[e,e+3+4,e+3+4]),...m(e,5,[e,e+4,e+4+3],e+4+3+2),...m(e,6,[e,e+3,e+3+4],e+4+3+3),...m(e,7,[e,e+4,e+4+3],e+4+3+4),y(e,8,[e,e+2,e+4+3]),y(e,9,[e,e+5,e+4+3]),...m(e,10,[e,e+3,e+3+4],e+4+3+2),y(e,11,[e,e+4,e+4+4]))})(),console.log(O);const g=e=>{const t=e.map((e=>e%12)).sort(((e,t)=>e-t));return O.filter((e=>Object(p.isEqual)(e.notes,t))).map((e=>({base:e.base,type:e.type})))},v=e=>e.map(((e,t)=>e-x[t])).reduce(((e,t)=>0===t?e+2:e+t),0),C=[];function _(e){return x.map(((t,s)=>e[s]+t))}function k(e){const t=e.map(((e,t)=>x[t]+e));return g(t).sort(((e,t)=>e.type-t.type)).map((e=>`${b[e.base]}${j[e.type]}`))}!function(){for(let e=0;e<8;e++)for(let t=0;t<8;t++)for(let s=0;s<8;s++){const n=[x[0]+e,x[1]+t,x[2]+s];g(n).forEach((e=>{Array.isArray(C[e.base])||(C[e.base]=[]),Array.isArray(C[e.base][e.type])||(C[e.base][e.type]=[]),C[e.base][e.type].push(n)}))}for(let e=0;e<C.length;e++)for(let t=0;t<C[e].length;t++){C[e][t].sort(((e,t)=>v(e)-v(t)))}}(),console.log("VALID_CHORDS",C);var w=s(3),S=s.n(w),A=s(0);const F=e=>{const{isChecked:t,positions:s,onClick:n}=e,c=(e,t)=>{const s=(e+t)%12;return e+t>=19?`${b[s]}'`:b[s]};return Object(A.jsxs)("div",{className:S.a.wrapper,onClick:()=>n(s),children:[Object(A.jsxs)("table",{className:S.a.chordview,children:[Object(A.jsxs)("thead",{children:[Object(A.jsx)("tr",{children:Object(A.jsx)("th",{colSpan:3,children:Object(A.jsx)("input",{type:"checkbox",checked:t,readOnly:!0})})}),Object(A.jsxs)("tr",{children:[Object(A.jsx)("th",{children:c(7,s[0])}),Object(A.jsx)("th",{children:c(14,s[1])}),Object(A.jsx)("th",{children:c(9,s[2])})]})]}),Object(A.jsx)("tbody",{children:new Array(7).fill(0).map(((e,t)=>Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:s[0]===t+1?"\u25cf":""}),Object(A.jsx)("td",{children:s[1]===t+1?"\u25cf":""}),Object(A.jsx)("td",{children:s[2]===t+1?"\u25cf":""})]},t)))})]}),Object(A.jsx)("div",{className:S.a.names,children:k(s).map((e=>Object(A.jsxs)(A.Fragment,{children:[e,Object(A.jsx)("br",{})]})))})]})};var N=()=>{var e;const t=Object(n.useRef)(null);Object(n.useEffect)((()=>{t.current=new h}),[]);const[s,c]=Object(n.useState)(0),[o,r]=Object(n.useState)(0),[a,l]=Object(n.useState)(440),[,d]=Object(n.useState)(0),u=(e,t)=>`viola-${e}${t}`,p=u(b[s],j[o]),O=(e,t)=>{const s=u(e,t),n=localStorage.getItem(s);if(n)try{const e=JSON.parse(n);if(Array.isArray(e)&&3===e.length&&e.every((e=>Number.isInteger(e))))return console.log(e,_(e)),_(e)}catch(c){}return function(e,t){return C[e][t]}(b.indexOf(e),j.indexOf(t))[0]},f=(e,s)=>{const n=O(e,s);c(b.indexOf(e)),r(j.indexOf(s)),t.current.playChord(n)},y=e=>b.map((t=>Object(A.jsxs)("button",{onClick:()=>f(t,e),children:[t,e]},t+e))),m=null!==(g=o,e=C[s][g].map((e=>e.map(((e,t)=>e-x[t])))))&&void 0!==e?e:[];var g;const v=e=>{const s=_(e);t.current.playChord(s),localStorage.setItem(p,JSON.stringify(e)),d(Date.now())};return Object(A.jsxs)("div",{className:i.a.app,onKeyDown:e=>{const t=["z","s","x","d","c","v","g","b","h","n","j","m",","];if(console.log(e.key),t.includes(e.key))return f(b[t.indexOf(e.key)%12],j[o]);const s=["1","2","3","4","5","6","7","8","9"];return s.includes(e.key)?r(s.indexOf(e.key)):void 0},tabIndex:0,children:[Object(A.jsx)("input",{className:i.a.tuner,type:"range",step:"0.1",min:"400",max:"500",value:a,onChange:e=>{return s=Number(e.target.value),l(s),void t.current.setFreq(s);var s}}),Object(A.jsx)("br",{}),a.toFixed(1),Object(A.jsx)("br",{}),j.map((e=>Object(A.jsxs)(A.Fragment,{children:[y(e),Object(A.jsx)("br",{})]}))),Object(A.jsx)("div",{className:i.a.chords,children:m.map((e=>(e=>{const t=JSON.stringify(e),s=t===localStorage.getItem(p);return Object(A.jsx)(F,{positions:e,onClick:v,isChecked:s},t)})(e)))})]})};var R=e=>{e&&e instanceof Function&&s.e(3).then(s.bind(null,20)).then((({getCLS:t,getFID:s,getFCP:n,getLCP:c,getTTFB:o})=>{t(e),s(e),n(e),c(e),o(e)}))};r.a.render(Object(A.jsx)(c.a.StrictMode,{children:Object(A.jsx)(N,{})}),document.getElementById("root")),R()},2:function(e,t,s){e.exports={app:"App_app__2ziFi",chords:"App_chords__7aOCV",tuner:"App_tuner__1cFdW"}},3:function(e,t,s){e.exports={chordview:"ChordView_chordview__1UQS7"}}},[[19,1,2]]]);
//# sourceMappingURL=main.42a529b1.chunk.js.map