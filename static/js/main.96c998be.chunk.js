(this.webpackJsonpbracsa=this.webpackJsonpbracsa||[]).push([[0],{15:function(e,t,n){},2:function(e,t,n){e.exports={chordbuttons:"ChordButtons_chordbuttons__1fCK-",pending:"ChordButtons_pending__2QeOF",active:"ChordButtons_active__1aWxQ",stop:"ChordButtons_stop__3dkpU"}},22:function(e,t,n){"use strict";n.r(t);var s=n(1),c=n.n(s),a=n(8),i=n.n(a),r=(n(15),n(7)),o=n.n(r),l=n(9),u=n.n(l);const d=window._tone_0411_FluidR3_GM_sf2_file;class h{constructor(){this.player=void 0,this.audioContext=void 0,this.envelopes=[],this.volume=.5,this.playbackRate=1,this.duration=.3;const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e,this.player=new u.a,this.player.loader.decodeAfterLoading(this.audioContext,"_tone_0411_FluidR3_GM_sf2_file"),console.log(this.player,d)}queueNote(e,t){const n=this.player.findZone(this.audioContext,d,e),s=n.originalPitch-100*n.coarseTune-n.fineTune,c=this.playbackRate*Math.pow(2,(100*e-s)/1200),a=this.player.queueWaveTable(this.audioContext,this.audioContext.destination,d,0,e,t,this.volume);a.audioBufferSourceNode.playbackRate.cancelScheduledValues(0),a.audioBufferSourceNode.playbackRate.setValueAtTime(c,0),this.envelopes.push(a)}playChord(e){this.stop(),e.forEach((e=>this.queueNote(e,this.duration)))}stop(){for(;;){const e=this.envelopes.pop();if(!e)break;e.cancel()}}get playing(){return this.envelopes.length>0}setFreq(e){this.playbackRate=e/440;const t=this.envelopes.map((e=>e.pitch));this.playChord(t)}setVolume(e){this.volume=e,0===this.volume&&(this.volume=1e-4);const t=this.envelopes.map((e=>e.pitch));this.playChord(t)}setDuration(e){this.duration=e}}var j=n(10);const b=["C","C\u266f","D","E\u266d","E","F","F\u266f","G","A\u266d","A","B","H"],p=[0,1,2,3,4,5,6,7,8,9,10,11],O=[6,1,8,3,10,5,0,7,2,9,4,11],y=["","m","7","dim","5","6","m7","maj7","sus2","sus4","m6","aug"],x=[55,62,57],m=[],f=e=>{const t=e.map((e=>e%12));return t.sort(((e,t)=>e-t)),t},g=(e,t,n)=>({base:e,type:t,notes:f(n)}),v=(e,t,n,s)=>[g(e,t,[n[0],n[1],s]),g(e,t,[n[0],s,n[2]]),g(e,t,[s,n[1],n[2]])];(()=>{for(let e=0;e<12;e++)m.push(g(e,0,[e,e+4,e+4+3]),g(e,1,[e,e+3,e+3+4]),...v(e,2,[e,e+4,e+4+3],e+4+3+3),g(e,3,[e,e+3,e+6]),g(e,4,[e,e,e+3+4]),g(e,4,[e,e+3+4,e+3+4]),...v(e,5,[e,e+4,e+4+3],e+4+3+2),...v(e,6,[e,e+3,e+3+4],e+4+3+3),...v(e,7,[e,e+4,e+4+3],e+4+3+4),g(e,8,[e,e+2,e+4+3]),g(e,9,[e,e+5,e+4+3]),...v(e,10,[e,e+3,e+3+4],e+4+3+2),g(e,11,[e,e+4,e+4+4]))})(),console.log(m);const C=e=>{const t=e.map((e=>e%12)).sort(((e,t)=>e-t));return m.filter((e=>Object(j.isEqual)(e.notes,t))).map((e=>({base:e.base,type:e.type})))},_=e=>e.map(((e,t)=>e-x[t])).reduce(((e,t)=>0===t?e+2:e+t),0),S=[];function k(e){return x.map(((t,n)=>e[n]+t))}function K(e){const t=e.map(((e,t)=>x[t]+e));return C(t).sort(((e,t)=>e.type-t.type)).map((e=>`${b[e.base]}${y[e.type]}`))}!function(){for(let e=0;e<8;e++)for(let t=0;t<8;t++)for(let n=0;n<8;n++){const s=[x[0]+e,x[1]+t,x[2]+n];C(s).forEach((e=>{Array.isArray(S[e.base])||(S[e.base]=[]),Array.isArray(S[e.base][e.type])||(S[e.base][e.type]=[]),S[e.base][e.type].push(s)}))}for(let e=0;e<S.length;e++)for(let t=0;t<S[e].length;t++){S[e][t].sort(((e,t)=>_(e)-_(t)))}}(),console.log("VALID_CHORDS",S);var N=n(2),w=n.n(N),D=n(0);const A=["z","s","x","d","c","v","g","b","h","n","j","m"],E=["KeyZ","KeyS","KeyX","KeyD","KeyC","KeyV","KeyG","KeyB","KeyH","KeyN","KeyJ","KeyM"],T=["1","2","3","4","5","6","7","8","9","0","-","="],F=["Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal"],B=["KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight"],L=["KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Backslash"],R=e=>{const{activeNote:t,activeType:n,pendingType:s,layout:c,setLayout:a,onClick:i,onStop:r}=e,o="chromatic"===c?A:T;return Object(D.jsxs)("div",{className:w.a.chordbuttons,children:[Object(D.jsxs)("table",{children:[Object(D.jsx)("thead",{children:Object(D.jsxs)("tr",{children:[Object(D.jsx)("td",{children:Object(D.jsx)("strong",{children:"Key"})}),o.map((e=>Object(D.jsx)("td",{children:e},e)))]})}),Object(D.jsxs)("tbody",{children:[y.map(((e,a)=>(e=>{const a="chromatic"===c?p:O,r=s=>n===e&&t===s;return Object(D.jsxs)("tr",{className:s===e?w.a.pending:"",children:[Object(D.jsx)("td",{children:e<9&&"chromatic"===c?e+1:""}),a.map((t=>Object(D.jsx)("td",{children:Object(D.jsxs)("button",{className:r(t)?w.a.active:"",onClick:()=>i(t,e),children:[b[t],y[e]]})},t+e)))]},e)})(a))),Object(D.jsxs)("tr",{children:[Object(D.jsx)("td",{children:"Space"}),Object(D.jsx)("td",{colSpan:12,children:Object(D.jsx)("button",{className:w.a.stop,onClick:r,children:"Stop"})})]})]})]}),Object(D.jsxs)("label",{children:[Object(D.jsx)("input",{type:"radio",name:"layout",value:"chromatic",checked:"chromatic"===c,onChange:e=>a(e.target.value)}),"Chromatic"]}),"\xa0\xa0\xa0\xa0",Object(D.jsxs)("label",{children:[Object(D.jsx)("input",{type:"radio",name:"layout",value:"fifths",checked:"fifths"===c,onChange:e=>a(e.target.value)}),"Circle of fifths"]})]})};var V=n(4),I=n.n(V);const q=e=>{const{isChecked:t,positions:n,onClick:s}=e,a=(e,t)=>{const n=(e+t)%12;return e+t>=19?`${b[n]}'`:b[n]};return Object(D.jsxs)("div",{className:I.a.wrapper,onClick:()=>s(n),children:[Object(D.jsxs)("table",{className:I.a.chordview,children:[Object(D.jsxs)("thead",{children:[Object(D.jsx)("tr",{children:Object(D.jsx)("th",{colSpan:3,children:Object(D.jsx)("input",{type:"checkbox",checked:t,readOnly:!0})})}),Object(D.jsxs)("tr",{children:[Object(D.jsx)("th",{children:a(7,n[0])}),Object(D.jsx)("th",{children:a(14,n[1])}),Object(D.jsx)("th",{children:a(9,n[2])})]})]}),Object(D.jsx)("tbody",{children:new Array(7).fill(0).map(((e,t)=>Object(D.jsxs)("tr",{children:[Object(D.jsx)("td",{children:n[0]===t+1?"\u25cf":""}),Object(D.jsx)("td",{children:n[1]===t+1?"\u25cf":""}),Object(D.jsx)("td",{children:n[2]===t+1?"\u25cf":""})]},t)))})]}),Object(D.jsx)("div",{className:I.a.names,children:K(n).map((e=>Object(D.jsxs)(c.a.Fragment,{children:[e,Object(D.jsx)("br",{})]},e)))})]})};var J=n(5),H=n.n(J);function M(e,t){const[n,c]=Object(s.useState)(e);return Object(s.useEffect)((()=>{const n=setTimeout((()=>{c(e)}),t);return()=>{clearTimeout(n)}}),[e,t]),n}const P=e=>{const{onSetVolume:t,onSetTuning:n}=e,[c,a]=Object(s.useState)(.5),i=M(c,50),[r,o]=Object(s.useState)(440),l=M(r,25);return Object(s.useEffect)((()=>{t(i)}),[t,i]),Object(s.useEffect)((()=>{n(l)}),[n,l]),Object(D.jsxs)("div",{className:H.a.sliders,children:[Object(D.jsxs)("label",{children:["Tuning",Object(D.jsx)("br",{}),Object(D.jsx)("input",{className:H.a.tuner,type:"range",step:"0.1",min:"400",max:"500",value:r,onChange:e=>o(Number(e.target.value))})]}),Object(D.jsxs)("label",{children:["Volume",Object(D.jsx)("br",{}),Object(D.jsx)("input",{className:H.a.tuner,type:"range",step:"0.02",min:"0",max:"1",value:c,onChange:e=>a(Number(e.target.value))})]})]})};var z=n(3),G=n.n(z);const Q=e=>{const{onSetSustain:t}=e,[n,c]=Object(s.useState)(null),a=M(n,25);return Object(s.useEffect)((()=>{t(a)}),[t,a]),Object(D.jsxs)("div",{className:G.a.sustain,children:[Object(D.jsxs)("div",{className:G.a.left,children:[Object(D.jsxs)("label",{children:[Object(D.jsx)("input",{type:"radio",name:"sustain",value:"sustain",checked:null===n,onChange:e=>c(null)}),"Sustain"]}),"\xa0\xa0\xa0\xa0",Object(D.jsxs)("label",{children:[Object(D.jsx)("input",{type:"radio",name:"sustain",value:"release",checked:null!==n,onChange:e=>c(.3)}),"Auto release"]})]}),Object(D.jsx)("div",{className:G.a.right,children:Object(D.jsxs)("label",{children:["Auto release timing",Object(D.jsx)("br",{}),Object(D.jsx)("input",{className:G.a.tuner,type:"range",step:"0.02",min:"0",max:"1",disabled:null===n,value:n,onChange:e=>c(Number(e.target.value))})]})})]})};var $=()=>{var e;const t=Object(s.useRef)(null),[n,c]=Object(s.useState)(!1);Object(s.useEffect)((()=>{t.current=new h,c(!0)}),[]);const[a,i]=Object(s.useState)(0),[r,l]=Object(s.useState)(0),[u,d]=Object(s.useState)(!0),[j,p]=Object(s.useState)(null),[m,f]=Object(s.useState)("chromatic"),[,g]=Object(s.useState)(0),v=(e,t)=>`viola-${e}${t}`,C=v(b[a],y[r]),_=Object(s.useCallback)(((e,t)=>{const n=v(e,t),s=localStorage.getItem(n);if(s)try{const e=JSON.parse(s);if(Array.isArray(e)&&3===e.length&&e.every((e=>Number.isInteger(e))))return console.log(e,k(e)),k(e)}catch(c){}return function(e,t){return S[e][t]}(b.indexOf(e),y.indexOf(t))[0]}),[]),K=Object(s.useCallback)(((e,n)=>{const s=_(b[e],y[n]);i(e),l(n),p(null),t.current.playChord(s)}),[_]),N=null!==(w=r,e=S[a][w].map((e=>e.map(((e,t)=>e-x[t])))))&&void 0!==e?e:[];var w;const A=e=>{const n=k(e);t.current.playChord(n),localStorage.setItem(C,JSON.stringify(e)),g(Date.now())},T=()=>{t.current.stop()},V=Object(s.useCallback)(((e,t)=>{if(console.log(t),E.includes(t))return K(E.indexOf(t)%12,null!==j&&void 0!==j?j:r),p(null),!0;const n=["1","2","3","4","5","6","7","8","9"];return n.includes(e)?(p(n.indexOf(e)),!0):" "===e&&(T(),!0)}),[j,r,K]),I=Object(s.useCallback)(((e,t)=>(console.log(t),F.includes(t)?(K(O[F.indexOf(t)%12],0),p(null),!0):B.includes(t)?(K(O[B.indexOf(t)%12],1),p(null),!0):L.includes(t)?(K(O[L.indexOf(t)%12],2),p(null),!0):" "===e&&(T(),!0))),[K]);Object(s.useEffect)((()=>{const e=e=>{if(e.ctrlKey||e.shiftKey||e.altKey)return;if(e.repeat)return;("chromatic"===m?V(e.key,e.code):I(e.key,e.code))&&(e.preventDefault(),e.stopPropagation())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[m,V,I]),Object(s.useEffect)((()=>{if(!u)return;const e=e=>{if(!(e.ctrlKey||e.shiftKey||e.altKey))return E.includes(e.code)||F.includes(e.code)||B.includes(e.code)||L.includes(e.code)?(T(),e.preventDefault(),e.stopPropagation(),!0):void 0};return document.addEventListener("keyup",e),()=>document.removeEventListener("keyup",e)}),[u]);const J=Object(s.useCallback)((e=>{t.current.setFreq(e)}),[]),H=Object(s.useCallback)((e=>{null===e?(t.current.setDuration(999),d(!0)):(t.current.setDuration(e),d(!1))}),[]),M=Object(s.useCallback)((e=>{t.current.setVolume(e)}),[]);return n?Object(D.jsxs)("div",{className:o.a.app,children:[Object(D.jsx)(R,{activeNote:a,activeType:r,pendingType:j,onClick:K,onStop:T,layout:m,setLayout:f}),Object(D.jsx)(Q,{onSetSustain:H}),Object(D.jsx)(P,{onSetTuning:J,onSetVolume:M}),Object(D.jsx)("div",{className:o.a.chords,children:N.map((e=>(e=>{const t=JSON.stringify(e),n=t===localStorage.getItem(C);return Object(D.jsx)(q,{positions:e,onClick:A,isChecked:n},t)})(e)))})]}):null};var Z=e=>{e&&e instanceof Function&&n.e(3).then(n.bind(null,23)).then((({getCLS:t,getFID:n,getFCP:s,getLCP:c,getTTFB:a})=>{t(e),n(e),s(e),c(e),a(e)}))};i.a.render(Object(D.jsx)(c.a.StrictMode,{children:Object(D.jsx)($,{})}),document.getElementById("root")),Z()},3:function(e,t,n){e.exports={sustain:"Sustain_sustain__yapZz",left:"Sustain_left__F1938",right:"Sustain_right__3zI1A",tuner:"Sustain_tuner__3wHn5"}},4:function(e,t,n){e.exports={chordview:"ChordView_chordview__1UQS7"}},5:function(e,t,n){e.exports={sliders:"Sliders_sliders__lzxZi",tuner:"Sliders_tuner__vf4HX"}},7:function(e,t,n){e.exports={app:"App_app__2ziFi",chords:"App_chords__7aOCV"}}},[[22,1,2]]]);
//# sourceMappingURL=main.96c998be.chunk.js.map